<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªÙØ§Ù‚ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">



  <!-- âœ… Header and sidebar -->
  <link rel="stylesheet" href="../background-header/Header-style.css" />
  <script src="../background-header/load-header.js" defer></script>
  <link rel="stylesheet" href="sidebar-style.css" />
  <script src="load-sidebar.js" defer></script>



  <style>
  .company-switcher {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
  }

  .company-btn {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    border-radius: 8px;
    box-shadow: none;
    transition: all 0.3s ease-in-out;
  }

  .active-btn {
    box-shadow: 0 0 10px 3px rgba(0,0,0,0.3);
  }

  .mamzar-bg {
    background-color: #dff5d2 !important;
  }

  .tradix-bg {
    background-color: #d2e8f5 !important;
  }


    :root {
      --primary: #1e3a8a;
      --secondary: #0f172a;
      --accent: #22d3ee;
      --danger: #ef4444;
      --text: #f8fafc;
      --glass: rgba(255, 255, 255, 0.05);
    }

    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e3a8a, #0f172a);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: var(--text);
      display: flex;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .main {
      flex: 1;
      padding: 30px;
      margin-top: 80px;
      margin-right: 250px;
    }

    .glass-card {
      background: var(--glass);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      padding: 35px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(18px);
      transition: 0.3s;
    }

    h2, h3 {
      color: #ffffff;
      margin-bottom: 25px;
      text-shadow: 1px 1px 3px #000;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 18px;
      color: #dbeafe;
    }

    input, select, textarea {
      width: 98%;
      padding: 14px;
      border: none;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.07);
      color: #e2e3f0;
      margin-top: 6px;
      backdrop-filter: blur(6px);
      box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.1);
      transition: 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 2px var(--accent);
    }
  /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© */
  #agreement-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }
    /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
  #start-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }

  /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
  #end-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }
 /* Ø­Ù‚Ù„ Credit Term */
  #credit-term {
    width: 150px;
    height: 45px;
    font-size: 16px;
  }
  /* Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ø±Ø¨ÙŠ */
  #extra-ar {
    width: 450px;
    height: 200px;
  }

  /* Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ */
  #extra-en {
    width: 450px;
    height: 200px;
  }

    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ ÙˆØµÙ Ø§Ù„Ø®Ø¯Ù…Ø© */

.item-desc {
  width: 300px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ */

.item-uom {
  width: 70px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± */

.item-price {
  width: 90px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */

.item-note {
  width: 200px;
  height: 30px;
  border-radius: 10px;
  padding: 8px;
}

/* âœ… ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„Ù€ Dropdowns */
select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: #24335A; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  color: #ffffff;
  padding: 12px 16px;
  border: 2px solid #00cfff;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  width: 100%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  transition: 0.3s ease-in-out;
  cursor: pointer;
  position: relative;
  z-index: 2;
}

/* âœ… ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù‡Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ù„ÙÙŠØ© SVG */
select:after {
  content: "â–¼";
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

/* âœ… Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆÙƒØ³ */
select:focus {
  outline: none;
  border-color: #66e0ff;
  box-shadow: 0 0 10px #00cfff;
}

/* âœ… ØªØ®ØµÙŠØµ Ø§Ù„Ù€ option Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
select option {
  background-color: #192d45;
  color: #ffffff;
  padding: 10px;
  border-bottom: 1px solid #333;
  font-weight: 500;
}

/* âœ… ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© */
select::-webkit-scrollbar {
  width: 8px;
}

select::-webkit-scrollbar-thumb {
  background: #00cfff;
  border-radius: 10px;
}

select::-webkit-scrollbar-track {
  background: #1a1a2e;
}

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø²Ø± Ø§Ù„Ø­Ø°Ù */

.delete-btn {
  background: linear-gradient(145deg, #1e1e2f, #232342);
  color: red;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 40px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 8px #f4a3a366;
  transition: transform 0.2s, box-shadow 0.2s;
}

.delete-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 10px #fcf9f999;
}

.delete-btn:hover {
  background-color: #e60000;
}

    button {
      padding: 14px 28px;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: white;
      font-size: 16px;
      font-weight: bold;
      margin-top: 25px;
      cursor: pointer;
      transition: 0.3s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }

    button:hover {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
    }

    .save-success {
      background: linear-gradient(135deg, #059669, #10b981) !important;
    }

    .two-cols {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    .two-cols > div {
      flex: 1;
    }

    table {
      width: 100%;
      margin-top: 18px;
      border-collapse: collapse;
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      background-color: rgba(255, 255, 255, 0.03);
      color: #e2e8f0;
    }

    th {
      background-color: var(--primary);
      color: white;
    }

    .row-actions button {
      background-color: var(--danger);
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
    }

    .download-btn {
      display: inline-flex;
      align-items: center;
      margin: 10px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      border-radius: 12px;
      text-decoration: none;
      gap: 8px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }

    .word-btn {
      background-color: #2b579a;
    }

    .word-btn:hover {
      background-color: #1e3a8a;
    }

    .pdf-btn {
      background-color: #b91c1c;
    }

    .pdf-btn:hover {
      background-color: #7f1d1d;
    }

    #download-section {
      text-align: center;
      margin-top: 30px;
      display: none;
    }

    #client-info {
      margin-top: 12px;
      font-size: 14px;
      color: #cbd5e1;
    }
    

    /* Ø­Ù‚Ù„ Ù…ÙƒØ§Ù† ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©  */
    .service-place-row {
  display: flex;
  justify-content: space-between; /* ØªÙˆØ²Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  gap: 30px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  margin-bottom: 25px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ­Øª Ø§Ù„ØµÙ */
}

.service-place-box {
  flex: 1; /* ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ§Ø®Ø¯ Ù†ØµÙ Ø§Ù„Ø¹Ø±Ø¶ */
  display: flex;
  flex-direction: column;
}

.service-place-box label {
  font-weight: bold;
  margin-bottom: 5px;
  text-align: right;
  color: #ffffffcc;
}

.service-place-box textarea {
  width: 95%;
  height: 70px;
  padding: 12px;
  font-size: 16px;
  background: rgba(255, 255, 255, 0.07);
  border-radius: 15px;
}
/* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø±Ø£Ø³ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
label {
  margin-top: 5px !important;  /* Ø¨Ø¯Ù„ 18px */
  margin-bottom: 3px !important;
}

input, select, textarea {
  margin-bottom: 3px !important;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù‚Ù„ */
}
/* Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚Ù„ ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */
.form-inline-group {
  display: flex;
  align-items: center;
  gap: 10px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚Ù„ */
  margin-bottom: 15px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø­Ù‚Ù„ */
.form-inline-group input[type="date"] {
  width: 250px;
}

h2 {
  margin-bottom: 0px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ­Øª Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³Ø¹Ø§Ø± */
}

#items-table {
  margin-top: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§ÙØ© Ø¹Ù„ÙˆÙŠØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³Ø¹Ø§Ø± */
}

.payment-duration-row {
  display: flex;
  align-items: center;
  gap: 40px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

/* Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ */
.credit-term-group {
  display: flex;
  flex-direction: column;
  min-width: 180px;
}

/* Ø§Ù„Ù…Ø¯Ø© */
.duration-inline-group {
  display: flex;
  flex-direction: column;
}

.duration-inline-inputs {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 5px;
}

.duration-inline-inputs label {
  margin: 0 5px;
}

/* âœ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ */
.company-btn.active-btn {
  box-shadow: 0 0 12px 4px rgba(255, 255, 255, 0.6);
  transform: scale(1.05);
}

/* âœ¨ Ø£Ù„ÙˆØ§Ù† Ø®Ù„ÙÙŠØ§Øª Ø§Ù„ØµÙØ­Ø§Øª */
body.tradix-bg {
  background: linear-gradient(135deg, #0f172a, #1e3a8a, #0f172a);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}

body.mamzar-bg {
  background: linear-gradient(135deg, #0f3d1e, #215d3a, #0f3d1e);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}

/* ØªØµÙ…ÙŠÙ… Ø¹Ø§Ù… Ù„Ø²Ø±Ø§ÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø±ÙƒØ© */

  /* ØªØ¬Ø§ÙˆØ² Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²Ø±Ø§Ø±ÙŠÙ† ÙÙ‚Ø· */
  #tradixBtn {
    background: hsl(214, 65%, 25%) !important;
    color: white !important;
  }

  #mamzarBtn {
    background: oklab(53.205999999999996% -0.14215 0.10958) !important;
    color: white !important;
  }

  .company-btn.active-btn {
    box-shadow: 0 0 12px 4px rgba(255, 255, 255, 0.6);
    transform: scale(1.05);
  }

  </style>
</head>
<body>


  
  <div id="header"></div>
  <div id="sidebar-container"></div>

  <div class="main">
    <div class="glass-card">
    <h2 style="text-align: center;">ğŸ“ Service Agreement Creation</h2>


      <div class="company-switcher">
        <button id="mamzarBtn" class="company-btn">Mamzar</button>
        <button id="tradixBtn" class="company-btn active-btn">Tradix</button>
      </div>

      <label for="client" style="margin-top: 25px;">: Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
      <select id="client" onchange="fillClientInfo()">
        <option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>
      </select>
      <div id="client-info" style="margin-top: 10px; font-weight: bold;"></div>

      <label for="agreement-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©:</label>
      <input type="date" id="agreement-date" />

      <h3>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯</h3>
      <table id="items-table">
        <thead>
          <tr>
            <th>Ø­Ø°Ù</th>
            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th>
            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø±Ù‚Ù…</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¯</button>

      <h3>Ù…ÙƒØ§Ù† ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
      <label>Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ:</label>
      <textarea id="agreement_Place_ar" dir="rtl"></textarea>

      <label>Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ:</label>
      <textarea id="agreement_Place_en" dir="ltr"></textarea>

      <h3>Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹</h3>
      <label for="credit-term">Credit Term:</label>
      <select id="credit-term">
        <option>15 Days</option>
        <option>30 Days</option>
        <option>45 Days</option>
        <option>60 Days</option>
      </select>

      <h3>Ù…Ø¯Ø© Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©</h3>
      <label>Ù…Ù†:</label>
      <input type="date" id="start-date" />
      <label>Ø¥Ù„Ù‰:</label>
      <input type="date" id="end-date" />

      <h3>Ø´Ø±ÙˆØ· Ø¥Ø¶Ø§ÙÙŠØ©</h3>
      <label>Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:</label>
      <textarea id="extra-ar" dir="rtl"></textarea>

      <label>Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©:</label>
      <textarea id="extra-en" dir="ltr"></textarea>

      <button id="save-btn" onclick="saveAgreement(event)">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©</button>

      <div id="download-section">
        <a id="download-link" class="download-btn word-btn" download>ğŸ“„ ØªØ­Ù…ÙŠÙ„ Word</a>
        <a id="download-pdf-link" class="download-btn pdf-btn" download>ğŸ“„ ØªØ­Ù…ÙŠÙ„ PDF</a>
      </div>
    </div>
  </div>
<script>
let selectedCompany = "tradix"; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©
let selectedTemplate = "agreement_templatev1.docx";
let clientsData = [];

document.addEventListener("DOMContentLoaded", () => {
  // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
  fetch("https://agreement-generator-kfsp.onrender.com/customers.json")
    .then(res => res.json())
    .then(data => {
      clientsData = data;
      const clientSelect = document.getElementById("client");
      clientSelect.innerHTML = `<option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>`;
      data.forEach((client, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = client.client_name_ar;
        clientSelect.appendChild(option);
      });
    });

  // âœ… Ø²Ø± ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Tradix
  document.getElementById("tradixBtn").addEventListener("click", () => {
    selectedCompany = "tradix";
    selectedTemplate = "agreement_templatev1.docx";
    toggleCompanyUI("tradix");
  });

  // âœ… Ø²Ø± ØªØºÙŠÙŠØ± Ø¥Ù„Ù‰ Mamzar
  document.getElementById("mamzarBtn").addEventListener("click", () => {
    selectedCompany = "mamzar";
    selectedTemplate = "agreement_template.docx";
    toggleCompanyUI("mamzar");
  });
});

// âœ… ØªØºÙŠÙŠØ± Ù…Ø¸Ù‡Ø± Ø§Ù„ØµÙØ­Ø© Ø­Ø³Ø¨ Ø§Ù„Ø´Ø±ÙƒØ©
function toggleCompanyUI(company) {
  document.getElementById("tradixBtn").classList.remove("active-btn");
  document.getElementById("mamzarBtn").classList.remove("active-btn");

  if (company === "tradix") {
    document.getElementById("tradixBtn").classList.add("active-btn");
    document.body.classList.remove("mamzar-bg");
    document.body.classList.add("tradix-bg");
  } else {
    document.getElementById("mamzarBtn").classList.add("active-btn");
    document.body.classList.remove("tradix-bg");
    document.body.classList.add("mamzar-bg");
  }
}

// âœ… Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„
function fillClientInfo() {
  const index = document.getElementById("client").value;
  const infoDiv = document.getElementById("client-info");

  if (index === "") {
    infoDiv.innerHTML = "<p>ğŸ”¹ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„.</p>";
    window.selectedClientData = null;
    return;
  }

  const client = clientsData[index];
  window.selectedClientData = client;

  infoDiv.innerHTML = `
    <p>ğŸ“„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ: ${client.client_cr}</p>
    <p>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¹Ø±Ø¨ÙŠ): ${client.client_address_ar}</p>
    <p>ğŸŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ): ${client.client_address_en}</p>
    <p>ğŸ‘¤ Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ): ${client.client_name_ar}</p>
    <p>ğŸ—£ï¸ Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ): ${client.client_name_en}</p>
  `;
}

// âœ… Ø¥Ø¶Ø§ÙØ© ØµÙ Ø¨Ù†Ø¯ Ø¬Ø¯ÙŠØ¯
function addRow() {
  const tbody = document.querySelector('#items-table tbody');
  const rowCount = tbody.rows.length;
  const row = tbody.insertRow();

  row.innerHTML = `
    <td><button class="delete-btn" onclick="deleteRow(this)">âŒ</button></td>
    <td><input type="text" class="item-note" /></td>
    <td><input type="number" class="item-price" /></td>
    <td><input type="text" class="item-uom" /></td>
    <td><input type="text" class="item-desc" /></td>
    <td>${rowCount + 1}</td>
  `;
}

// âœ… Ø­Ø°Ù ØµÙ
function deleteRow(btn) {
  btn.closest("tr").remove();
  reorderRows();
}

// âœ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙÙˆÙ
function reorderRows() {
  const rows = document.querySelectorAll("#items-table tbody tr");
  rows.forEach((r, i) => {
    r.cells[5].textContent = i + 1;
  });
}

// âœ… Ø­ÙØ¸ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©
function saveAgreement(e) {
  if (e) e.preventDefault();

  const items = [...document.querySelectorAll('#items-table tbody tr')].map(row => ({
    desc: row.cells[4].querySelector('input').value,
    uom: row.cells[3].querySelector('input').value,
    price: row.cells[2].querySelector('input').value,
    note: row.cells[1].querySelector('input').value,
  }));

  const clientIndex = document.getElementById('client').value;
  const client = clientsData[clientIndex];

  if (!client) {
    alert("âš ï¸ Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„Ù‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§.");
    return;
  }

  const data = {
    selectedCompany,
    selectedTemplate,
    agreement_date: document.getElementById('agreement-date').value,
    agreement_Place_ar: document.getElementById("agreement_Place_ar").value,
    agreement_Place_en: document.getElementById("agreement_Place_en").value,
    credit_term: document.getElementById('credit-term').value,
    start_date: document.getElementById('start-date').value,
    end_date: document.getElementById('end-date').value,
    items_table: items,
    extra_ar: document.getElementById('extra-ar').value,
    extra_en: document.getElementById('extra-en').value,

    client_name_ar: client.client_name_ar,
    client_name_en: client.client_name_en,
    client_address_ar: client.client_address_ar,
    client_address_en: client.client_address_en,
    client_cr: client.client_cr,
    client_vat: client.client_vat,
    client_id: client.client_id
  };

  fetch("https://agreement-generator-kfsp.onrender.com/generate", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  })
  .then(res => {
    if (res.ok) {
      document.getElementById("save-btn").textContent = "âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸";
      document.getElementById("save-btn").classList.add("save-success");
      document.getElementById("download-section").style.display = "block";

      document.getElementById("download-link").href = `https://agreement-generator-kfsp.onrender.com/download?company=${selectedCompany}`;
      document.getElementById("download-pdf-link").href = `https://agreement-generator-kfsp.onrender.com/download-pdf?company=${selectedCompany}`;
    } else {
      alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸.");
    }
  })
  .catch(err => {
    console.error(err);
    alert("âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
  });
}
</script>
