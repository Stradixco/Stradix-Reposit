<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªÙØ§Ù‚ÙŠØ©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">



  <!-- âœ… Header and sidebar -->
  <link rel="stylesheet" href="../background-header/Header-style.css" />
  <script src="../background-header/load-header.js" defer></script>
  <link rel="stylesheet" href="sidebar-style.css" />
  <script src="load-sidebar.js" defer></script>



  <style>
  .company-switcher {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
  }

  .company-btn {
    padding: 10px 20px;
    font-size: 16px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    border-radius: 8px;
    box-shadow: none;
    transition: all 0.3s ease-in-out;
  }

  .active-btn {
    box-shadow: 0 0 10px 3px rgba(0,0,0,0.3);
  }

  .mamzar-bg {
    background-color: #dff5d2 !important;
  }

  .tradix-bg {
    background-color: #d2e8f5 !important;
  }


    :root {
      --primary: #1e3a8a;
      --secondary: #0f172a;
      --accent: #22d3ee;
      --danger: #ef4444;
      --text: #f8fafc;
      --glass: rgba(255, 255, 255, 0.05);
    }

    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #0f172a, #1e3a8a, #0f172a);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      color: var(--text);
      display: flex;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .main {
      flex: 1;
      padding: 30px;
      margin-top: 80px;
      margin-right: 250px;
    }

    .glass-card {
      background: var(--glass);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 18px;
      padding: 35px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(18px);
      transition: 0.3s;
    }

    h2, h3 {
      color: #ffffff;
      margin-bottom: 25px;
      text-shadow: 1px 1px 3px #000;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 18px;
      color: #dbeafe;
    }

    input, select, textarea {
      width: 98%;
      padding: 14px;
      border: none;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.07);
      color: #e2e3f0;
      margin-top: 6px;
      backdrop-filter: blur(6px);
      box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.1);
      transition: 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 2px var(--accent);
    }
  /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ© */
  #agreement-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }
    /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
  #start-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }

  /* Ø­Ù‚Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
  #end-date {
    width: 150px;
    height: 15px;
    font-size: 16px;
  }
 /* Ø­Ù‚Ù„ Credit Term */
  #credit-term {
    width: 150px;
    height: 45px;
    font-size: 16px;
  }
  /* Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¹Ø±Ø¨ÙŠ */
  #extra-ar {
    width: 450px;
    height: 200px;
  }

  /* Ø§Ù„Ø¨Ù†Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ */
  #extra-en {
    width: 450px;
    height: 200px;
  }

    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ ÙˆØµÙ Ø§Ù„Ø®Ø¯Ù…Ø© */

.item-desc {
  width: 300px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ */

.item-uom {
  width: 70px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ Ø§Ù„Ø³Ø¹Ø± */

.item-price {
  width: 90px;
  height: 20px;
  border-radius: 10px;
  padding: 8px;
}
  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø­Ù‚Ù„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */

.item-note {
  width: 200px;
  height: 30px;
  border-radius: 10px;
  padding: 8px;
}

/* âœ… ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù… Ù„ÙƒÙ„ Ø§Ù„Ù€ Dropdowns */
select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  background-color: #24335A; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
  color: #ffffff;
  padding: 12px 16px;
  border: 2px solid #00cfff;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  width: 100%;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  transition: 0.3s ease-in-out;
  cursor: pointer;
  position: relative;
  z-index: 2;
}

/* âœ… ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ù‡Ù… Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ù„ÙÙŠØ© SVG */
select:after {
  content: "â–¼";
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
}

/* âœ… Ø¹Ù†Ø¯ Ø§Ù„ÙÙˆÙƒØ³ */
select:focus {
  outline: none;
  border-color: #66e0ff;
  box-shadow: 0 0 10px #00cfff;
}

/* âœ… ØªØ®ØµÙŠØµ Ø§Ù„Ù€ option Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© */
select option {
  background-color: #192d45;
  color: #ffffff;
  padding: 10px;
  border-bottom: 1px solid #333;
  font-weight: 500;
}

/* âœ… ØªØ®ØµÙŠØµ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© */
select::-webkit-scrollbar {
  width: 8px;
}

select::-webkit-scrollbar-thumb {
  background: #00cfff;
  border-radius: 10px;
}

select::-webkit-scrollbar-track {
  background: #1a1a2e;
}

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯: Ø²Ø± Ø§Ù„Ø­Ø°Ù */

.delete-btn {
  background: linear-gradient(145deg, #1e1e2f, #232342);
  color: red;
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  border: none;
  border-radius: 12px;
  width: 40px;
  height: 40px;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 8px #f4a3a366;
  transition: transform 0.2s, box-shadow 0.2s;
}

.delete-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 10px #fcf9f999;
}

.delete-btn:hover {
  background-color: #e60000;
}

    button {
      padding: 14px 28px;
      border: none;
      border-radius: 16px;
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: white;
      font-size: 16px;
      font-weight: bold;
      margin-top: 25px;
      cursor: pointer;
      transition: 0.3s ease;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }

    button:hover {
      background: linear-gradient(135deg, #2563eb, #3b82f6);
    }

    .save-success {
      background: linear-gradient(135deg, #059669, #10b981) !important;
    }

    .two-cols {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }

    .two-cols > div {
      flex: 1;
    }

    table {
      width: 100%;
      margin-top: 18px;
      border-collapse: collapse;
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      text-align: center;
      background-color: rgba(255, 255, 255, 0.03);
      color: #e2e8f0;
    }

    th {
      background-color: var(--primary);
      color: white;
    }

    .row-actions button {
      background-color: var(--danger);
      box-shadow: 0 0 8px rgba(0,0,0,0.3);
    }

    .download-btn {
      display: inline-flex;
      align-items: center;
      margin: 10px;
      padding: 14px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      border-radius: 12px;
      text-decoration: none;
      gap: 8px;
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }

    .word-btn {
      background-color: #2b579a;
    }

    .word-btn:hover {
      background-color: #1e3a8a;
    }

    .pdf-btn {
      background-color: #b91c1c;
    }

    .pdf-btn:hover {
      background-color: #7f1d1d;
    }

    #download-section {
      text-align: center;
      margin-top: 30px;
      display: none;
    }

    #client-info {
      margin-top: 12px;
      font-size: 14px;
      color: #cbd5e1;
    }
    

    /* Ø­Ù‚Ù„ Ù…ÙƒØ§Ù† ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø©  */
    .service-place-row {
  display: flex;
  justify-content: space-between; /* ØªÙˆØ²Ø¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  gap: 30px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
  margin-bottom: 25px; /* Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ­Øª Ø§Ù„ØµÙ */
}

.service-place-box {
  flex: 1; /* ÙƒÙ„ ÙˆØ§Ø­Ø¯ ÙŠØ§Ø®Ø¯ Ù†ØµÙ Ø§Ù„Ø¹Ø±Ø¶ */
  display: flex;
  flex-direction: column;
}

.service-place-box label {
  font-weight: bold;
  margin-bottom: 5px;
  text-align: right;
  color: #ffffffcc;
}

.service-place-box textarea {
  width: 95%;
  height: 70px;
  padding: 12px;
  font-size: 16px;
  background: rgba(255, 255, 255, 0.07);
  border-radius: 15px;
}
/* âœ… ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø±Ø£Ø³ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
label {
  margin-top: 5px !important;  /* Ø¨Ø¯Ù„ 18px */
  margin-bottom: 3px !important;
}

input, select, textarea {
  margin-bottom: 3px !important;  /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù‚Ù„ */
}
/* Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚Ù„ ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */
.form-inline-group {
  display: flex;
  align-items: center;
  gap: 10px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ø­Ù‚Ù„ */
  margin-bottom: 15px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„ØµÙÙˆÙ */
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø­Ù‚Ù„ */
.form-inline-group input[type="date"] {
  width: 250px;
}

h2 {
  margin-bottom: 0px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ© ØªØ­Øª Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³Ø¹Ø§Ø± */
}

#items-table {
  margin-top: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§ÙØ© Ø¹Ù„ÙˆÙŠØ© Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³Ø¹Ø§Ø± */
}

.payment-duration-row {
  display: flex;
  align-items: center;
  gap: 40px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

/* Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ */
.credit-term-group {
  display: flex;
  flex-direction: column;
  min-width: 180px;
}

/* Ø§Ù„Ù…Ø¯Ø© */
.duration-inline-group {
  display: flex;
  flex-direction: column;
}

.duration-inline-inputs {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 5px;
}

.duration-inline-inputs label {
  margin: 0 5px;
}

/* âœ¨ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ */
.company-btn.active-btn {
  box-shadow: 0 0 12px 4px rgba(255, 255, 255, 0.6);
  transform: scale(1.05);
}

/* âœ¨ Ø£Ù„ÙˆØ§Ù† Ø®Ù„ÙÙŠØ§Øª Ø§Ù„ØµÙØ­Ø§Øª */
body.tradix-bg {
  background: linear-gradient(135deg, #0f172a, #1e3a8a, #0f172a);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}

body.mamzar-bg {
  background: linear-gradient(135deg, #0f3d1e, #215d3a, #0f3d1e);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
}

/* ØªØµÙ…ÙŠÙ… Ø¹Ø§Ù… Ù„Ø²Ø±Ø§ÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø±ÙƒØ© */

  /* ØªØ¬Ø§ÙˆØ² Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø²Ø±Ø§Ø±ÙŠÙ† ÙÙ‚Ø· */
  #tradixBtn {
    background: hsl(214, 65%, 25%) !important;
    color: white !important;
  }

  #mamzarBtn {
    background: oklab(53.205999999999996% -0.14215 0.10958) !important;
    color: white !important;
  }

  .company-btn.active-btn {
    box-shadow: 0 0 12px 4px rgba(255, 255, 255, 0.6);
    transform: scale(1.05);
  }

  </style>
</head>
<body>


  
  <div id="header"></div>
  <div id="sidebar-container"></div>

  <div class="main">
    <div class="glass-card">
    <h2 style="text-align: center;">ğŸ“ Service Agreement Creation</h2>


<div id="companySelector" style="display: flex; justify-content: center; gap: 25px; margin-bottom: 20px;">
  <button id="mamzarBtn" class="company-btn">Mamzar Est</button>
  <button id="tradixBtn" class="company-btn active-btn">Tradix Co</button>
</div>

<div style="text-align: left;"> 
  <label for="client">: Customer</label> 
  <select id="client" onchange="fillClientInfo()" style="padding: 6px; border-radius: 5px;">
    <option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>
  </select>
</div>
<div id="client-info" style="margin-top: 10px; font-weight: bold;"></div>
      
</div>

      <div id="client-info"></div>

    <div class="form-inline-group" style="justify-content: left;">
            <input type="date" id="agreement-date" name="agreement-date">

      <label for="agreement-date">:Agreement Date</label>
    </div>

<h2 style="text-align: left;">Service Price Table</h2>

<table id="items-table">
  <thead>
    <tr>
      <th>Delete</th>
      <th>Note</th>
      <th>Price</th>
      <th>UOM</th>
      <th>Description</th>
      <th>S/N</th>
    </tr>
  </thead>
  <tbody>
    <!-- Ø§Ù„ØµÙÙˆÙ Ø³ØªÙØ¶Ø§Ù Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
  </tbody>
</table>

<!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
<button onclick="addRow()">â• Add Item</button>

<!-- âœ… Ø³ÙƒØ±Ø¨Øª Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª - Ø¶Ø¹Ù‡ ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© -->
<script>
  function addRow() {
    const table = document.getElementById("items-table").getElementsByTagName("tbody")[0];
    const rowCount = table.rows.length;
    const row = table.insertRow();

    row.innerHTML = `
      <td>
        <button class="delete-btn" onclick="deleteRow(this)">âŒ</button>
      </td>
      <td><input type="text" class="item-note" style="text-align: left;" /></td>
      <td><input type="number" class="item-price" style="text-align: left;" /></td>
      <td><input type="text" class="item-uom" style="text-align: left;" /></td>
      <td><input type="text" class="item-desc" style="text-align: left;" /></td>
      <td>${rowCount + 1}</td>
    `;
  }

  function deleteRow(btn) {
    const row = btn.closest("tr");
    row.remove();

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙÙˆÙ
    const rows = document.querySelectorAll("#items-table tbody tr");
    rows.forEach((r, index) => {
      r.cells[5].textContent = index + 1; // Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£Ø®ÙŠØ± Ù‡Ùˆ Ø±Ù‚Ù… Ø§Ù„ØµÙ
    });
  }
</script>
<script>
  // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† localStorage ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø¯Ø±ÙˆØ¨ Ø¯Ø§ÙˆÙ†
  function populateClientDropdown() {
    const clients = JSON.parse(localStorage.getItem("customersList") || "[]");
    const clientSelect = document.getElementById("client");

    clients.forEach(client => {
      const option = document.createElement("option");
      option.value = client.id; // Ù†Ø®Ø²Ù† ID ÙƒÙ€ value
      option.textContent = client.nameAr; // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ
      clientSelect.appendChild(option);
    });
  }

  // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ØŒ Ù†Ù…Ù„Ø£ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ÙÙŠØ© Ø£Ùˆ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
  function fillClientInfo() {
    const clientId = document.getElementById("client").value;
    const clients = JSON.parse(localStorage.getItem("customersList") || "[]");
    const selectedClient = clients.find(c => c.id === clientId);
    
    if (selectedClient) {
      // Ù‡Ù†Ø§ ÙŠØªÙ… Ø±Ø¨Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙÙŠ Ù…Ù„Ù Ø§Ù„ÙˆÙˆØ±Ø¯
      window.selectedClientData = {
client_name_ar: window.selectedClientData.client_name_ar,
client_name_en: window.selectedClientData.client_name_en,
client_address_ar: window.selectedClientData.client_address_ar,
client_address_en: window.selectedClientData.client_address_en,
client_cr: window.selectedClientData.client_cr,
client_vat: window.selectedClientData.client_vat,
client_id: window.selectedClientData.client_id
      };
    }
  }


let clientsData = [];

async function loadClients() {
  try {
    const response = await fetch("https://agreement-generator-kfsp.onrender.com/customers.json");
    clientsData = await response.json();

    const dropdown = document.getElementById("client");
    dropdown.innerHTML = `<option value="">-- Ø§Ø®ØªØ± Ø¹Ù…ÙŠÙ„ --</option>`; // Reset

    clientsData.forEach((client, index) => {
      const option = document.createElement("option");
      option.value = index;
      option.textContent = client.client_name_ar;
      dropdown.appendChild(option);
    });

  } catch (error) {
    console.error("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:", error);
  }
}

function fillClientInfo() {
  const selectedIndex = document.getElementById("client").value;
  const infoDiv = document.getElementById("client-info");

  if (selectedIndex === "") {
    infoDiv.innerHTML = '<p>ğŸ”¹ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„.</p>';
    window.selectedClientData = null;
    return;
  }

  const selectedClient = clientsData[selectedIndex];
  window.selectedClientData = selectedClient; // ğŸŸ¡ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØ©

  infoDiv.innerHTML = `
    <p>ğŸ“„ CR: ${selectedClient.client_cr}</p>
    <p>ğŸ“ Address (AR): ${selectedClient.client_address_ar}</p>
    <p>ğŸŒ Address (EN): ${selectedClient.client_address_en}</p>
    <p>ğŸ§¾ VAT: ${selectedClient.client_vat}</p>
  `;
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù…Ø¬Ø±Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener("DOMContentLoaded", loadClients);

  
  // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø£ÙˆÙ„ÙŠ Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  window.addEventListener("DOMContentLoaded", populateClientDropdown);
</script>

<script>
  async function loadCustomers() {
    try {
      const response = await fetch('./customers.json');
      const customers = await response.json();

      const clientSelect = document.getElementById("client");
      clientSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ --</option>';

      customers.forEach((customer, index) => {
        const option = document.createElement("option");
        option.value = index;
        option.textContent = customer.client_name_ar;
        clientSelect.appendChild(option);
      });

      // ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù„Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§
      window.customersData = customers;

    } catch (error) {
      console.error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:", error);
    }
  }

  function fillClientInfo() {
    const selectedIndex = document.getElementById("client").value;
    if (selectedIndex === "") return;

    const selectedCustomer = window.customersData[selectedIndex];
    window.selectedClientData = {
client_name_ar: window.selectedClientData.client_name_ar,
client_name_en: window.selectedClientData.client_name_en,
client_address_ar: window.selectedClientData.client_address_ar,
client_address_en: window.selectedClientData.client_address_en,
client_cr: window.selectedClientData.client_cr,
client_vat: window.selectedClientData.client_vat,
client_id: window.selectedClientData.client_id
      
    };
  }

  window.onload = loadCustomers;
</script>

<!-- Ù…ÙƒØ§Ù† ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø© -->
<div class="service-place-row">
  
  <div class="service-place-box">
    <label for="agreement_place_ar" style="display: block; text-align: left;">
      ğŸ“ Arabic Service Place
    </label>
    <textarea name="agreement_Place_ar" id="agreement_Place_ar" style="text-align: right;" dir="rtl"></textarea>
  </div>

  <div class="service-place-box">
    <label for="agreement_place_en" style="display: block; text-align: left;">
      ğŸ“ English Service Place
    </label>
    <textarea name="agreement_Place_en" id="agreement_Place_en" style="text-align: left;" dir="ltr"></textarea>
  </div>

</div>


<div class="payment-duration-row">
<!-- Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ ÙˆØ§Ù„Ù…Ø¯Ø© ÙÙŠ ØµÙ ÙˆØ§Ø­Ø¯ - ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆÙ…Ø­Ø§Ø°Ø§Ø© Ù„Ù„ÙŠØ³Ø§Ø± -->
<div class="form-inline-group" style="justify-content: left;">
  <!-- Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ -->
  <div style="display: flex; align-items: center; gap: 10px;">
    <select id="credit-term" style="width: 150px;">
      <option>15 Days</option>
      <option>30 Days</option>
      <option>45 Days</option>
      <option>60 Days</option>
      <option>90 Days</option>
    </select>
        <label for="credit-term" style="margin: 0;">:Credit Terms</label>

  </div>

  <!-- Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ØªÙŠÙ† -->
  <div style="width: 40px;"></div>

  <!-- Ø§Ù„Ù…Ø¯Ø© Ù…Ù† ÙˆØ¥Ù„Ù‰ -->
  <div style="display: flex; align-items: center; gap: 30px;">
    <input type="date" id="end-date" />
        <label for="end-date" style="margin: 0;">To</label>
         <input type="date" id="start-date" />
        <label for="start-date" style="margin: 0;">From</label>
        <label style="margin: 0;">:Agreement duration</label>

  </div>
</div>


    </div>

<h3 style="text-align: left;">Additional Terms</h3>

<div class="two-cols">
  <!-- Arabic Item  -->
  <div>
    <label style="text-align: left; display: block;">:Arabic Item </label>
    <textarea id="extra-ar" rows="2" dir="rtl" style="text-align: right;"></textarea>
  </div>

  <!-- English Item -->
  <div>
    <label style="text-align: left; display: block;">:English Item</label>
    <textarea id="extra-en" rows="2" dir="ltr" style="text-align: left;"></textarea>
  </div>
</div>

<button id="save-btn" type="button" onclick="saveAgreement(event)">
  ğŸ’¾ Save Agreement
</button>

<!-- âœ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Word + PDF) -->
<div id="download-section" style="display: none; text-align: center; margin-top: 30px;">
<a id="download-link" href="#" class="download-btn word-btn" download style="margin-right: 15px;">
  <img src="https://upload.wikimedia.org/wikipedia/commons/1/19/Microsoft_Office_Word_%282019%E2%80%932025%29.svg"
       alt="Word"
       style="width: 24px; vertical-align: middle; margin-right: 8px;">
  Word Download (Word)
</a>

<a id="download-pdf-link" href="#" class="download-btn pdf-btn" download>
  <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/PDF_file_icon.svg" alt="PDF" style="width: 24px; vertical-align: middle; margin-right: 8px;">
  PDF Download (PDF)
  </a>
</div>

<script>
const tbody = document.querySelector('#items-table tbody');

function fillClientInfo() {
  const selectedIndex = document.getElementById("client").value;
  const infoDiv = document.getElementById("client-info");

  if (selectedIndex === "") {
    infoDiv.innerHTML = '<p>ğŸ”¹ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„.</p>';
    return;
  }

  const selectedCustomer = window.customersData[selectedIndex];
  window.selectedClientData = {
    client_name_ar: selectedCustomer.client_name_ar,
    client_name_en: selectedCustomer.client_name_en,
    client_address_ar: selectedCustomer.client_address_ar,
    client_address_en: selectedCustomer.client_address_en,
    client_cr: selectedCustomer.client_cr
  };

  infoDiv.innerHTML = `
    <p>ğŸ“„ <strong>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ:</strong> ${selectedCustomer.client_cr}</p>
    <p>ğŸ“ <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¹Ø±Ø¨ÙŠ):</strong> ${selectedCustomer.client_address_ar}</p>
    <p>ğŸŒ <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ):</strong> ${selectedCustomer.client_address_en}</p>
    <p>ğŸ‘¤ <strong>Ø§Ù„Ø§Ø³Ù… (Ø¹Ø±Ø¨ÙŠ):</strong> ${selectedCustomer.client_name_ar}</p>
    <p>ğŸ—£ï¸ <strong>Ø§Ù„Ø§Ø³Ù… (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ):</strong> ${selectedCustomer.client_name_en}</p>
  `;
}
body: JSON.stringify({
  selectedCompany: 'Mamzar', // Ø£Ùˆ 'Tradix'
  agreement_date: "...",
  client_name: "...",
  // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
})


function addItem() {
  const row = tbody.insertRow();
  row.innerHTML = `
    <td></td>
    <td><input type="text" /></td>
    <td><input type="text" /></td>
    <td><input type="number" /></td>
    <td><input type="text" /></td>
    <td><button onclick="removeRow(this)">âŒ</button></td>
  `;
  reorderRows();
}

function removeRow(btn) {
  btn.closest('tr').remove();
  reorderRows();
}

function reorderRows() {
  [...tbody.rows].forEach((row, index) => {
    row.cells[0].textContent = index + 1;
  });
}

<script>
let selectedCompany = "tradix"; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Tradix
let selectedTemplate = "agreement_templatev1.docx"; // Ù…Ù„Ù Tradix Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

const tradixBtn = document.getElementById("tradixBtn");
const mamzarBtn = document.getElementById("mamzarBtn");

// Ø­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
document.body.classList.add("tradix-bg");

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Tradix
tradixBtn.addEventListener("click", () => {
  selectedCompany = "tradix";
  selectedTemplate = "agreement_templatev1.docx";

  tradixBtn.classList.add("active-btn");
  mamzarBtn.classList.remove("active-btn");

  document.body.classList.remove("mamzar-bg");
  document.body.classList.add("tradix-bg");

  updateFieldColors("#ffffff", "#00cfff");
});

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Mamzar
mamzarBtn.addEventListener("click", () => {
  selectedCompany = "mamzar";
  selectedTemplate = "agreement_template.docx";

  mamzarBtn.classList.add("active-btn");
  tradixBtn.classList.remove("active-btn");

  document.body.classList.remove("tradix-bg");
  document.body.classList.add("mamzar-bg");

  updateFieldColors("#fafff3", "#2ecc71");
});

function saveAgreement(e) {
  if (e) e.preventDefault();

  const items = [...document.querySelectorAll('#items-table tbody tr')].map(row => ({
    desc: row.cells[4].querySelector('input').value,
    uom: row.cells[3].querySelector('input').value,
    price: row.cells[2].querySelector('input').value,
    note: row.cells[1].querySelector('input').value,
  }));

  const data = {
    agreement_date: document.getElementById('agreement-date').value,
    client_name: document.getElementById('client').value,
    agreement_Place_ar: document.getElementById("agreement_Place_ar").value,
    agreement_Place_en: document.getElementById("agreement_Place_en").value,
    credit_term: document.getElementById('credit-term').value,
    start_date: document.getElementById('start-date').value,
    end_date: document.getElementById('end-date').value,
    items_table: items,
    extra_ar: document.getElementById('extra-ar').value,
    extra_en: document.getElementById('extra-en').value
  };

// ØªØ¹Ø¯ÙŠÙ„ Ø·Ù„Ø¨ POST Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„ÙØ¹Ù„ÙŠ
fetch("https://agreement-generator-kfsp.onrender.com/generate", {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
})
  .then(res => {
    if (res.ok) {
      document.getElementById('save-btn').textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸';
      document.getElementById('save-btn').classList.add('save-success');
      document.getElementById('download-section').style.display = 'block';
      // âœ… ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©
document.getElementById('download-link').href =
  `https://agreement-generator-kfsp.onrender.com/download?company=${selectedCompany}`;

document.getElementById('download-pdf-link').href =
  `https://agreement-generator-kfsp.onrender.com/download-pdf?company=${selectedCompany}`;

    } else {
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸.");
    }
  })
  .catch(err => {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.");
    console.error(err);
  });
}
</script>
<script>
let selectedCompany = "tradix"; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Tradix
let selectedTemplate = "agreement_templatev1.docx"; // Ù…Ù„Ù Tradix Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ

const tradixBtn = document.getElementById("tradixBtn");
const mamzarBtn = document.getElementById("mamzarBtn");

// Ø­Ø§Ù„Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
document.body.classList.add("tradix-bg");

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Tradix
tradixBtn.addEventListener("click", () => {
  selectedCompany = "tradix";
  selectedTemplate = "agreement_templatev1.docx";

  // ÙØ¹Ù‘Ù„ Ø§Ù„Ø²Ø±
  tradixBtn.classList.add("active-btn");
  mamzarBtn.classList.remove("active-btn");

  // ØºÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ©
  document.body.classList.remove("mamzar-bg");
  document.body.classList.add("tradix-bg");

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙˆÙ„
  updateFieldColors("#ffffff", "#00cfff");
});

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Mamzar
mamzarBtn.addEventListener("click", () => {
  selectedCompany = "mamzar";
  selectedTemplate = "agreement_template.docx";

  mamzarBtn.classList.add("active-btn");
  tradixBtn.classList.remove("active-btn");

  document.body.classList.remove("tradix-bg");
  document.body.classList.add("mamzar-bg");

  updateFieldColors("#fafff3", "#2ecc71");
});


function saveAgreement(e) {
  if (e) e.preventDefault();

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const items = [...document.querySelectorAll('#items-table tbody tr')].map(row => ({
    desc: row.cells[4].querySelector('input').value,
    uom: row.cells[3].querySelector('input').value,
    price: row.cells[2].querySelector('input').value,
    note: row.cells[1].querySelector('input').value,
  }));

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
  let entity_name_ar, entity_name_en, entity_detail_ar, entity_detail_en;

  if (selectedCompany === "mamzar") {
    entity_name_ar = "Ù…Ø¤Ø³Ø³Ø© Ù…Ù…Ø²Ø± Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©";
    entity_name_en = "Mamzar for General Contracting Est";
    entity_detail_ar = `Ù…Ø¤Ø³Ø³Ø© Ù…Ù…Ø²Ø± Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
Ø³Ø¬Ù„ ØªØ¬Ø§Ø±ÙŠ: 2050073487
Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø­ÙŠ ØºØ±Ù†Ø§Ø·Ø© Ø´ Ø·Ø±ÙØ© Ø¨Ù† Ø§Ù„Ø¹Ø¨Ø¯ , Ø§Ù„Ø¯Ù…Ø§Ù… , Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©`;
    entity_detail_en = `Mamzar for General Contracting Est
CR :2050073487
Adress: Ghernata Dist, Turfa bin Alabd St, Dammam, KSA`;
  } else {
    entity_name_ar = "Ø´Ø±ÙƒØ© Ø§Ø³ ØªØ±Ø¯ÙŠÙƒØ³Ø³Ø§";
    entity_name_en = "S TRADIXSA COMPANY";
    entity_detail_ar = `Ø´Ø±ÙƒØ© Ø§Ø³ ØªØ±Ø¯ÙŠÙƒØ³Ø³Ø§
ØªØ¬Ø§Ø±ÙŠ Ø¹Ø±Ø¨ÙŠ : 7052015091
Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø­ÙŠ Ù‚Ø±Ø·Ø¨Ø© , Ø´Ø§Ø±Ø¹ Ø·Ø§Ø±Ù‚ Ø¨Ù† Ø²ÙŠØ§Ø¯ , Ø§Ù„Ø®Ø¨Ø± , Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©`;
    entity_detail_en = `S TRADIXSA COMPANY
CR: 7052015091
Adress: Al-Khubar Qurtuban Dist , Tariq bin Ziyad, King of Saudi Arabia`;
  }

  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  const clientIndex = document.getElementById('client').value;
  const selectedClientData = clientsData[parseInt(clientIndex)];

  if (!selectedClientData) {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„.");
    return;
  }

  // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©
  const data = {
    selectedCompany,
    selectedTemplate,
    entity_name_ar,
    entity_name_en,
    entity_detail_ar,
    entity_detail_en,
    agreement_date: document.getElementById('agreement-date').value,
    agreement_Place_ar: document.getElementById("agreement_Place_ar").value,
    agreement_Place_en: document.getElementById("agreement_Place_en").value,
    credit_term: document.getElementById('credit-term').value,
    start_date: document.getElementById('start-date').value,
    end_date: document.getElementById('end-date').value,
    items_table: items,
    extra_ar: document.getElementById('extra-ar').value,
    extra_en: document.getElementById('extra-en').value,

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
    client_name_ar: selectedClientData.client_name_ar,
    client_name_en: selectedClientData.client_name_en,
    client_address_ar: selectedClientData.client_address_ar,
    client_address_en: selectedClientData.client_address_en,
    client_cr: selectedClientData.client_cr,
    client_vat: selectedClientData.client_vat,
    client_id: selectedClientData.client_id
  };

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
  fetch("https://agreement-generator-kfsp.onrender.com/generate", {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(data)
  })
  .then(res => {
    if (res.ok) {
      document.getElementById('save-btn').textContent = 'âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸';
      document.getElementById('save-btn').classList.add('save-success');
      document.getElementById('download-section').style.display = 'block';
      // âœ… ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ©
document.getElementById('download-link').href =
  `https://agreement-generator-kfsp.onrender.com/download?company=${selectedCompany}`;

document.getElementById('download-pdf-link').href =
  `https://agreement-generator-kfsp.onrender.com/download-pdf?company=${selectedCompany}`;

    } else {
      alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸.");
    }
  })
  .catch(err => {
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±.");
    console.error(err);
  });
}
</script>
</body>
</html>

